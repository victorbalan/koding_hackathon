//= require lib/quintus
//= require lib/quintus_2d
//= require lib/quintus_anim
//= require lib/quintus_audio
//= require lib/quintus_input
//= require lib/quintus_scenes
//= require lib/quintus_sprites
//= require lib/quintus_tmx
//= require lib/quintus_touch
//= require lib/quintus_ui

var events = [ { event: 'NORMAL', time: 0, x: 100, y: 100, angle: 0, carSpeed: 0 },
  { event: 'NORMAL',
    time: 0.1,
    x: 100,
    y: 100,
    angle: 0,
    carSpeed: 0 },
  { event: 'NORMAL',
    time: 0.2,
    x: 100,
    y: 100.4,
    angle: 0,
    carSpeed: 4 },
  { event: 'NORMAL',
    time: 0.30000000000000004,
    x: 100,
    y: 101.2,
    angle: 0,
    carSpeed: 8 },
  { event: 'NORMAL',
    time: 0.4,
    x: 100,
    y: 102.4,
    angle: 0,
    carSpeed: 12 },
  { event: 'NORMAL',
    time: 0.5,
    x: 100,
    y: 104,
    angle: 0,
    carSpeed: 16 },
  { event: 'NORMAL',
    time: 0.6,
    x: 100,
    y: 106,
    angle: 0,
    carSpeed: 20 },
  { event: 'NORMAL',
    time: 0.7,
    x: 100,
    y: 108.4,
    angle: 0,
    carSpeed: 24 },
  { event: 'NORMAL',
    time: 0.7999999999999999,
    x: 100,
    y: 111.2,
    angle: 0,
    carSpeed: 28 },
  { event: 'NORMAL',
    time: 0.8999999999999999,
    x: 100,
    y: 114.4,
    angle: 0,
    carSpeed: 32 },
  { event: 'NORMAL',
    time: 0.9999999999999999,
    x: 100,
    y: 118,
    angle: 0,
    carSpeed: 36 },
  { event: 'NORMAL',
    time: 1.0999999999999999,
    x: 100,
    y: 122,
    angle: 0,
    carSpeed: 40 },
  { event: 'NORMAL',
    time: 1.2,
    x: 100,
    y: 126.4,
    angle: 0,
    carSpeed: 44 },
  { event: 'NORMAL',
    time: 1.3,
    x: 100,
    y: 131.20000000000002,
    angle: 0,
    carSpeed: 48 },
  { event: 'NORMAL',
    time: 1.4000000000000001,
    x: 100,
    y: 136.4,
    angle: 0,
    carSpeed: 52 },
  { event: 'NORMAL',
    time: 1.5000000000000002,
    x: 100,
    y: 142,
    angle: 0,
    carSpeed: 56 },
  { event: 'NORMAL',
    time: 1.6000000000000003,
    x: 100,
    y: 148,
    angle: 0,
    carSpeed: 60 },
  { event: 'NORMAL',
    time: 1.7000000000000004,
    x: 100,
    y: 150,
    angle: 90,
    carSpeed: 64 },
  { event: 'NORMAL',
    time: 1.8000000000000005,
    x: 106.8,
    y: 150,
    angle: 90,
    carSpeed: 68 },
  { event: 'NORMAL',
    time: 1.9000000000000006,
    x: 113.8,
    y: 150,
    angle: 90,
    carSpeed: 70 },
  { event: 'NORMAL',
    time: 2.0000000000000004,
    x: 120.8,
    y: 150,
    angle: 90,
    carSpeed: 70 },
  { event: 'NORMAL',
    time: 2.1000000000000005,
    x: 127.8,
    y: 150,
    angle: 90,
    carSpeed: 70 },
  { event: 'NORMAL',
    time: 2.2000000000000006,
    x: 134.8,
    y: 150,
    angle: 90,
    carSpeed: 70 },
  { event: 'NORMAL',
    time: 2.3000000000000007,
    x: 141.8,
    y: 150,
    angle: 90,
    carSpeed: 70 },
  { event: 'NORMAL',
    time: 2.400000000000001,
    x: 148.8,
    y: 150,
    angle: 90,
    carSpeed: 70 },
  { event: 'NORMAL',
    time: 2.500000000000001,
    x: 150,
    y: 150,
    angle: 0,
    carSpeed: 70 },
  { event: 'NORMAL',
    time: 2.600000000000001,
    x: 150,
    y: 157,
    angle: 0,
    carSpeed: 70 },
  { event: 'NORMAL',
    time: 2.700000000000001,
    x: 150,
    y: 164,
    angle: 0,
    carSpeed: 70 },
  { event: 'NORMAL',
    time: 2.800000000000001,
    x: 150,
    y: 171,
    angle: 0,
    carSpeed: 70 },
  { event: 'NORMAL',
    time: 2.9000000000000012,
    x: 150,
    y: 178,
    angle: 0,
    carSpeed: 70 },
  { event: 'NORMAL',
    time: 3.0000000000000013,
    x: 150,
    y: 185,
    angle: 0,
    carSpeed: 70 },
  { event: 'NORMAL',
    time: 3.1000000000000014,
    x: 150,
    y: 192,
    angle: 0,
    carSpeed: 70 },
  { event: 'NORMAL',
    time: 3.2000000000000015,
    x: 150,
    y: 199,
    angle: 0,
    carSpeed: 70 },
  { event: 'NORMAL',
    time: 3.3000000000000016,
    x: 150,
    y: 200,
    angle: -45,
    carSpeed: 70 },
  { event: 'NORMAL',
    time: 3.4000000000000017,
    x: 145.05025253169416,
    y: 204.94974746830584,
    angle: -45,
    carSpeed: 70 },
  { event: 'NORMAL',
    time: 3.5000000000000018,
    x: 140.1005050633883,
    y: 209.8994949366117,
    angle: -45,
    carSpeed: 70 },
  { event: 'NORMAL',
    time: 3.600000000000002,
    x: 135.15075759508247,
    y: 214.84924240491753,
    angle: -45,
    carSpeed: 70 },
  { event: 'NORMAL',
    time: 3.700000000000002,
    x: 130.20101012677662,
    y: 219.79898987322338,
    angle: -45,
    carSpeed: 70 },
  { event: 'NORMAL',
    time: 3.800000000000002,
    x: 125.2512626584708,
    y: 224.74873734152922,
    angle: -45,
    carSpeed: 70 },
  { event: 'NORMAL',
    time: 3.900000000000002,
    x: 120.30151519016496,
    y: 229.69848480983507,
    angle: -45,
    carSpeed: 70 },
  { event: 'NORMAL',
    time: 4.000000000000002,
    x: 115.35176772185913,
    y: 234.64823227814088,
    angle: -45,
    carSpeed: 70 },
  { event: 'NORMAL',
    time: 4.100000000000001,
    x: 110.4020202535533,
    y: 239.59797974644673,
    angle: -45,
    carSpeed: 70 },
  { event: 'NORMAL',
    time: 4.200000000000001,
    x: 105.45227278524746,
    y: 244.54772721475254,
    angle: -45,
    carSpeed: 70 },
  { event: 'NORMAL',
    time: 4.300000000000001,
    x: 100,
    y: 250,
    angle: 0,
    carSpeed: 70 },
  { event: 'NORMAL',
    time: 4.4,
    x: 100,
    y: 257,
    angle: 0,
    carSpeed: 70 },
  { event: 'NORMAL',
    time: 4.5,
    x: 100,
    y: 264,
    angle: 0,
    carSpeed: 70 },
  { event: 'NORMAL',
    time: 4.6,
    x: 100,
    y: 270.95,
    angle: 0,
    carSpeed: 69.5 },
  { event: 'NORMAL',
    time: 4.699999999999999,
    x: 100,
    y: 277.84999999999997,
    angle: 0,
    carSpeed: 69 },
  { event: 'NORMAL',
    time: 4.799999999999999,
    x: 100,
    y: 284.7,
    angle: 0,
    carSpeed: 68.5 },
  { event: 'NORMAL',
    time: 4.899999999999999,
    x: 100,
    y: 291.5,
    angle: 0,
    carSpeed: 68 },
  { event: 'NORMAL',
    time: 4.999999999999998,
    x: 100,
    y: 298.25,
    angle: 0,
    carSpeed: 67.5 },
  { event: 'FINISH',
    time: 4.999999999999998,
    x: 100,
    y: 298.25,
    angle: 0,
    carSpeed: 67.5 } ];

$(document).ready(function() {
  	var Q = Quintus()
  			.setup("game")
  			.include("Sprites, UI, Input, Touch, Anim, Scenes, 2D")
  			.controls()
  			.touch();

  	Q.Sprite.extend("Car", {
	    init: function(p) {
	        this._super(p, {
	        	sheet: "car",
	        	sprite: "car",
	        	frame: 0
	        });         
	   	}	   	
	});

	Q.animations('car', {
		go: { frames: [1], loop: false},
		stop: { frames: [0], loop: false },
	});

	Q.scene('Game', function(stage) {
		stage.insert(new Q.Repeater({asset: "background.png", scale: 1}))

		/*stage.insert(new Q.TileLayer({
			dataAsset: 'circuit.json',
			sheet: 'tiles'
		}));*/

		var car = new Q.Car({x: 100, y:100, scale: 0.4}); 
		car.add("tween");

		stage.insert(car);
		stage.add("viewport").follow(car, {x:true, y:true});

		stage.viewport.scale = 2;

		for (i = 0; i < events.length - 1; i++) {
   			car.chain({x: events[i].x * 32, y: events[i].y * 32, angle: - events[i].angle}, events[i+1].time - events[i].time);
   		}	
	});
 
 	Q.load("car.png, tiles.png, background.png", function() {
 		Q.sheet("tiles", "tiles.png", {tilew: 32, tileh: 32});
 		Q.sheet("car", "car.png", {tilew: 63, tileh: 118});
 		Q.stageScene("Game");
 	});
});
